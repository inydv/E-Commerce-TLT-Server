import{o as b,A as S,_ as f,T as x,r as p,u as F,b as y,j as u,R as q}from"./index-e8f8ca07.js";import{R as v}from"./RSConversion.Pipe-ac2552a8.js";import{M,F as O}from"./index-4e68b7ec.js";const P=async s=>{var n,o,l,r;try{return await b.post(S.payment.verification,s)}catch(a){if((o=(n=a==null?void 0:a.response)==null?void 0:n.data)!=null&&o.MESSAGE)return f.error((r=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:r.MESSAGE,x.error)}},k=async s=>{var n,o,l,r;try{return await b.post(S.payment.createOrder,s)}catch(a){if((o=(n=a==null?void 0:a.response)==null?void 0:n.data)!=null&&o.MESSAGE)return f.error((r=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:r.MESSAGE,x.error)}},G=async()=>{var s,n,o,l;try{return await b.get(S.payment.keyId)}catch(r){if((n=(s=r==null?void 0:r.response)==null?void 0:s.data)!=null&&n.MESSAGE)return f.error((l=(o=r==null?void 0:r.response)==null?void 0:o.data)==null?void 0:l.MESSAGE,x.error)}},Y=[{type:"text",label:"Name *",name:"name",autoFocus:!0,placeholder:"Lokesh Yadav",className:"form-input-text",required:!0,labelClass:"form-label"},{type:"email",label:"Email *",name:"email",autoFocus:!0,placeholder:"nitin@mail.com",className:"form-input-text",required:!0,labelClass:"form-label",containerClass:"mt-4"},{type:"number",label:"Phone *",name:"phone",autoFocus:!0,placeholder:"1234567890",className:"form-input-text",required:!0,labelClass:"form-label",containerClass:"mt-4"},{type:"text",label:"Address *",name:"address",autoFocus:!0,placeholder:"House no. 123, street no. 1",className:"form-input-text",required:!0,labelClass:"form-label",containerClass:"mt-4"},{type:"text",label:"City *",name:"city",autoFocus:!0,placeholder:"New Delhi",className:"form-input-text",required:!0,labelClass:"form-label",containerClass:"mt-4"},{type:"text",label:"State *",name:"state",autoFocus:!0,placeholder:"State",className:"form-input-text",required:!0,labelClass:"form-label",containerClass:"mt-4"},{type:"number",label:"Pincode *",name:"pincode",autoFocus:!0,placeholder:"123456",className:"form-input-text",required:!0,labelClass:"form-label",containerClass:"mt-4"}],m=({title:s,price:n,containerClass:o,priceClass:l})=>y("div",{className:`flex justify-between gap-5 ${o}`,children:[u("h1",{className:"font-semibold text-base sm:text-lg",children:s}),u("p",{className:`text-base sm:text-lg ${l}`,children:v(n)})]});function U({cart:s,shippingCharges:n=0}){const[o,l]=p.useState(0),[r,a]=p.useState(!1),[e,h]=p.useState({}),[A,N]=p.useState(null),R=F(),T=t=>{t.preventDefault(),localStorage.setItem("address",JSON.stringify(e)),a(!1)},_=()=>{w()},I=t=>{const i={key:A,amount:n+o,currency:"INR",name:"The Little Things",description:"This is Simple but exciting E-commerce WebApp",image:"/src/Assets/logo.svg",order_id:t,prefill:{name:e==null?void 0:e.name,email:e==null?void 0:e.email,contact:e==null?void 0:e.phone},notes:{address:`${e==null?void 0:e.address}, ${e==null?void 0:e.city}, ${e==null?void 0:e.state}, ${e==null?void 0:e.pincode}`},theme:{color:"#000000"},handler:async function(c){const d={paymentInfo:{razorpay_payment_id:c.razorpay_payment_id,razorpay_order_id:c.razorpay_order_id,razorpay_signature:c.razorpay_signature},shippingInformation:e,orderItems:s==null?void 0:s.map(g=>({product:g.product._id,quantity:g.quantity}))},{data:E}=await P(d);E&&E.SUCCESS&&(localStorage.removeItem("cart"),R(q.myOrders))}};new window.Razorpay(i).open()},w=async()=>{var i;const{data:t}=await k({amount:n+o});t&&t.SUCCESS&&I((i=t==null?void 0:t.DATA)==null?void 0:i.id)},z=async()=>{var i;const{data:t}=await G();t&&t.SUCCESS&&N((i=t==null?void 0:t.DATA)==null?void 0:i.key_id)};return p.useEffect(()=>{const t=(C,c)=>{var d;return C+(c==null?void 0:c.quantity)*((d=c==null?void 0:c.product)==null?void 0:d.price)},i=s==null?void 0:s.reduce(t,0);l(i||0)},[s]),p.useEffect(()=>{const t=JSON.parse(localStorage.getItem("address"))||{};h(t),z()},[]),y("section",{className:"bg-customGray max-w-[400px] w-full p-5",children:[u(m,{price:o,title:"Sub Total",containerClass:"mb-3 sm:mb-5"}),u(m,{price:n,title:"Shipping Charges",containerClass:"mb-3 sm:mb-5"}),u(m,{price:n+o,title:"Gross Total",containerClass:"mb-5 sm:mb-10",priceClass:"text-green-500"}),y("div",{className:"flex justify-end gap-5",children:[u("button",{className:"font-semibold text-base py-2 px-4 bg-black",onClick:()=>a(!0),children:"Address"}),u("button",{className:"font-semibold text-base py-2 px-4 bg-black",onClick:()=>_(),children:"Payment"})]}),u(M,{open:r,setOpen:a,title:"Shipping Address",content:u(O,{submitForm:T,form:Y,formData:e,setFormData:h})})]})}export{U as default};
