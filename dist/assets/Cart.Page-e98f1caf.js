import{bW as C,bX as w,_ as E,T as A,r as i,bT as _,j as d,a as t,bR as O,b as z,bM as F}from"./index-addfd89c.js";import{R as y}from"./RSConversion.Pipe-ac2552a8.js";import{U as S}from"./Cart.Pipe-fd18fa2f.js";import{N as P}from"./NotAvailable.Component-62ad9905.js";import{A as j}from"./TableHeader-334b072f.js";const G=async e=>{var r,l,c,n;try{return await C.post(w.payment.verification,e)}catch(a){if((l=(r=a==null?void 0:a.response)==null?void 0:r.data)!=null&&l.MESSAGE)return E.error((n=(c=a==null?void 0:a.response)==null?void 0:c.data)==null?void 0:n.MESSAGE,A.error)}},M=async e=>{var r,l,c,n;try{return await C.post(w.payment.createOrder,e)}catch(a){if((l=(r=a==null?void 0:a.response)==null?void 0:r.data)!=null&&l.MESSAGE)return E.error((n=(c=a==null?void 0:a.response)==null?void 0:c.data)==null?void 0:n.MESSAGE,A.error)}},U=async()=>{var e,r,l,c;try{return await C.get(w.payment.keyId)}catch(n){if((r=(e=n==null?void 0:n.response)==null?void 0:e.data)!=null&&r.MESSAGE)return E.error((c=(l=n==null?void 0:n.response)==null?void 0:l.data)==null?void 0:c.MESSAGE,A.error)}},Y=[{type:"text",label:"Name *",name:"name",autoFocus:!0,placeholder:"Lokesh Yadav",className:"bg-black outline-none border-b-2 w-full border-gray p-1 text-sm",required:!0,labelClass:"block mb-1"},{type:"email",label:"Email *",name:"email",autoFocus:!0,placeholder:"nitin@mail.com",className:"bg-black outline-none border-b-2 w-full border-gray p-1 text-sm",required:!0,labelClass:"block mb-1",containerClass:"mt-4"},{type:"number",label:"Phone *",name:"phone",autoFocus:!0,placeholder:"1234567890",className:"bg-black outline-none border-b-2 w-full border-gray p-1 text-sm",required:!0,labelClass:"block mb-1",containerClass:"mt-4"},{type:"text",label:"Address *",name:"address",autoFocus:!0,placeholder:"House no. 123, street no. 1",className:"bg-black outline-none border-b-2 w-full border-gray p-1 text-sm",required:!0,labelClass:"block mb-1",containerClass:"mt-4"},{type:"text",label:"City *",name:"city",autoFocus:!0,placeholder:"New Delhi",className:"bg-black outline-none border-b-2 w-full border-gray p-1 text-sm",required:!0,labelClass:"block mb-1",containerClass:"mt-4"},{type:"text",label:"State *",name:"state",autoFocus:!0,placeholder:"State",className:"bg-black outline-none border-b-2 w-full border-gray p-1 text-sm",required:!0,labelClass:"block mb-1",containerClass:"mt-4"},{type:"number",label:"Pincode *",name:"pincode",autoFocus:!0,placeholder:"123456",className:"bg-black outline-none border-b-2 w-full border-gray p-1 text-sm",required:!0,labelClass:"block mb-1",containerClass:"mt-4"}];function K({cart:e,shippingCharges:r=0}){const[l,c]=i.useState(0),[n,a]=i.useState(!1),[s,p]=i.useState({}),[h,x]=i.useState(),g=_(),u=()=>{localStorage.setItem("address",JSON.stringify(s)),a(!1)},N=()=>{I()},q=o=>{const b={key:h,amount:r+l,currency:"INR",name:"The Little Things",description:"This is Simple but exciting E-commerce WebApp",image:"/dist/assets/logo.svg",order_id:o,prefill:{name:s==null?void 0:s.name,email:s==null?void 0:s.email,contact:s==null?void 0:s.phone},notes:{address:`${s==null?void 0:s.address}, ${s==null?void 0:s.city}, ${s==null?void 0:s.state}, ${s==null?void 0:s.pincode}`},theme:{color:"#000000"},handler:async function(m){const f={paymentInfo:{razorpay_payment_id:m.razorpay_payment_id,razorpay_order_id:m.razorpay_order_id,razorpay_signature:m.razorpay_signature},shippingInformation:s,orderItems:e==null?void 0:e.map(T=>({product:T.product._id,quantity:T.quantity}))},{data:v}=await G(f);v&&v.SUCCESS&&(localStorage.removeItem("cart"),g(F.myOrders))}};new window.Razorpay(b).open()},I=async()=>{var b;const{data:o}=await M({amount:r+l});o&&o.SUCCESS&&q((b=o==null?void 0:o.DATA)==null?void 0:b.id)},R=async()=>{var b;const{data:o}=await U();o&&o.SUCCESS&&x((b=o==null?void 0:o.DATA)==null?void 0:b.key_id)};return i.useEffect(()=>{const o=(k,m)=>{var f;return k+(m==null?void 0:m.quantity)*((f=m==null?void 0:m.product)==null?void 0:f.price)},b=e==null?void 0:e.reduce(o,0);c(b)},[e]),i.useEffect(()=>{const o=JSON.parse(localStorage.getItem("address"))||{};p(o),R()},[]),d("div",{className:"bg-customGray max-w-[400px] w-full p-5",children:[d("div",{className:"flex justify-between gap-5 mb-3 sm:mb-5",children:[t("h1",{className:"font-semibold text-base sm:text-lg",children:"Sub Total"}),t("p",{className:"text-base sm:text-lg",children:y(l)})]}),d("div",{className:"flex justify-between gap-5 mb-3 sm:mb-5",children:[t("h1",{className:"font-semibold text-base sm:text-lg",children:"Shipping Charges"}),t("p",{className:"text-base sm:text-lg",children:y(r)})]}),d("div",{className:"flex justify-between gap-5 mb-5 sm:mb-10",children:[t("h1",{className:"font-semibold text-base sm:text-lg",children:"Gross Total"}),t("p",{className:"text-green-500 text-base sm:text-lg",children:y(r+l)})]}),d("div",{className:"flex justify-end gap-5",children:[t("button",{className:"font-semibold text-base py-2 px-4 bg-black",onClick:()=>a(!0),children:"Address"}),t("button",{className:"font-semibold text-base py-2 px-4 bg-black",onClick:()=>N(),children:"Payment"})]}),t(O,{setOpen:a,open:n,title:"Shipping Address",content:t(z,{form:Y,formData:s,setFormData:p}),handleBtn:u,btnText:"Add"})]})}function $({data:e}){var n,a,s,p,h,x,g;const[r,l]=i.useState(e==null?void 0:e.quantity),c=u=>{var N;u==="increase"&&r<((N=e==null?void 0:e.product)==null?void 0:N.quantity)?(S({...e,quantity:r+1}),l(r+1)):u==="decrease"&&r>1&&(S({...e,quantity:r-1}),l(r-1))};return d("tr",{children:[t("td",{className:"border border-gray-500 p-2",children:t("div",{className:"grid place-content-center",children:t("img",{src:((n=e==null?void 0:e.product)==null?void 0:n.images)&&((s=(a=e==null?void 0:e.product)==null?void 0:a.images[0])==null?void 0:s.url),alt:"Product Image",className:"h-20 w-20",onError:({currentTarget:u})=>{u.onerror=null,u.src="/dist/assets/NoImageAvailable.jpg"}})})}),d("td",{className:"border border-gray-500 py-2 px-4",children:[t("h6",{className:"line-clamp text-sm sm:text-base",children:(p=e==null?void 0:e.product)==null?void 0:p.name}),d("div",{className:"flex items-center my-2",children:[d("div",{className:"flex",children:[t("button",{className:"primary-button",onClick:()=>c("decrease"),children:"-"}),t("input",{type:"number",className:"w-[25px] sm:w-[50px] outline-none text-black text-sm sm:text-base px-1 text-center font-semibold",readOnly:!0,value:r}),t("button",{className:"primary-button",onClick:()=>c("increase"),children:"+"})]}),t("p",{className:"text-sm sm:text-base font-bold px-2",children:"X"}),t("p",{className:"text-sm sm:text-base",children:y((h=e==null?void 0:e.product)==null?void 0:h.price)})]}),r<=((x=e==null?void 0:e.product)==null?void 0:x.quantity)?t("p",{className:"text-sm sm:text-base font-semibold text-green-500",children:"In Stock"}):t("p",{className:"text-sm sm:text-base font-semibold text-red-700",children:"Out Of Stock"})]}),t("td",{className:"border border-gray-500 p-2",children:t("p",{className:"text-center line-clamp",children:y(((g=e==null?void 0:e.product)==null?void 0:g.price)*r)})}),t("td",{className:"border border-gray-500 p-2",children:t("div",{className:"grid place-content-center",children:t("button",{className:"primary-button",onClick:()=>S({...e},!0),children:"X"})})})]})}function Q(){var l,c;const[e,r]=i.useState([]);return i.useEffect(()=>{window.scrollTo(0,0);const n=()=>{const a=JSON.parse(localStorage.getItem("cart"));r(a)};return window.addEventListener("storage",()=>{n()}),n(),()=>window.removeEventListener("storage",n())},[]),d("div",{className:"p-5 sm:p-10",children:[t("div",{className:"rounded mb-5",children:t("div",{className:"p-2",children:d("table",{className:"w-full",children:[t("thead",{children:t("tr",{children:i.Children.toArray((c=(l=j)==null?void 0:l.cart)==null?void 0:c.map(n=>t("th",{className:"border border-gray-500 p-2",children:n})))})}),t("tbody",{children:(e==null?void 0:e.length)>0?i.Children.toArray(e==null?void 0:e.map(n=>t($,{data:n}))):t("tr",{children:t("td",{colSpan:"100%",className:"border border-gray-500 px-5 py-10",children:t(P,{})})})})]})})}),t("div",{className:"flex justify-end",children:t(K,{cart:e})})]})}export{Q as default};
